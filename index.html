<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arixo Messenger Pro | Firebase Real-time</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* CSS เดิมของคุณทั้งหมด (ไม่ตัดออก) */
        :root {
            --bg: #e0f7f1; --bg-gradient: radial-gradient(circle at center, #f0fffb, #b2f2e3);
            --card: #ffffff; --primary: #18e0c4; --primary-grad: linear-gradient(135deg, #18e0c4, #0d9488);
            --text: #1c1e21; --muted: #65676b; --bubble-me: #18e0c4; --bubble-you: #e6ffad; --accent: #ff4757;
        }
        body.dark-mode { --bg: #0b1220; --card: #0f1c26; --text: #f5f6f7; --muted: #90949c; --bubble-me: #0d9488; --bubble-you: #242f3d; }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #app { width: 100%; max-width: 500px; height: 100%; background: var(--card); display: flex; flex-direction: column; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .chat-header { padding: 15px 20px; background: var(--primary-grad); color: white; display: flex; align-items: center; gap: 12px; z-index: 100; }
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: var(--bg-gradient); }
        
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 20px; position: relative; font-size: 15px; line-height: 1.4; animation: pop 0.3s ease; }
        .msg.me { align-self: flex-end; background: var(--bubble-me); color: white; border-bottom-right-radius: 4px; }
        .msg.you { align-self: flex-start; background: var(--bubble-you); color: #2d3436; border-bottom-left-radius: 4px; }
        
        .input-area { padding: 15px; background: var(--card); display: flex; align-items: center; gap: 10px; border-top: 1px solid rgba(0,0,0,0.05); }
        .input-wrapper { flex: 1; display: flex; align-items: center; background: #f0f2f5; border-radius: 25px; padding: 5px 15px; }
        #mainInput { border: none; background: transparent; flex: 1; padding: 10px; outline: none; }
        
        /* สไตล์ฟีเจอร์อื่นๆ เช่น Reply Bar, Call Overlay... (คงเดิมไว้) */
        #replyBar { display: none; padding: 10px 20px; background: rgba(0,0,0,0.05); border-left: 4px solid var(--primary); }
        .react-badge { position: absolute; bottom: -10px; right: 10px; background: white; border-radius: 10px; padding: 2px 5px; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        @keyframes pop { from { opacity: 0; transform: translateY(10px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
</head>
<body class="">

<div id="app">
    <div class="chat-header">
        <i class="fa fa-chevron-left"></i>
        <div style="flex:1">
            <div style="font-weight:bold">Arixo Global Chat</div>
            <div id="status" style="font-size:11px; opacity:0.8">เชื่อมต่อระบบ Cloud แล้ว</div>
        </div>
        <i class="fa fa-moon" onclick="document.body.classList.toggle('dark-mode')"></i>
        <i class="fa fa-video" onclick="openCall('Video')"></i>
        <i class="fa fa-phone" onclick="openCall('Voice')"></i>
    </div>

    <div id="replyBar">
        <div style="font-size:12px; color:var(--primary)">กำลังตอบกลับ...</div>
        <div id="replyText" style="font-size:13px; opacity:0.7"></div>
    </div>

    <div id="chat-container"></div>

    <div class="input-area">
        <div class="input-wrapper">
            <i class="fa fa-smile" style="color:var(--muted); margin-right:8px;"></i>
            <input type="text" id="mainInput" placeholder="พิมพ์ข้อความ..." onkeypress="if(event.key==='Enter') sendMsg()">
        </div>
        <button onclick="sendMsg()" style="background:var(--primary-grad); border:none; color:white; width:45px; height:45px; border-radius:50%; cursor:pointer; box-shadow: 0 4px 10px rgba(24,224,196,0.3);">
            <i class="fa fa-paper-plane"></i>
        </button>
    </div>
</div>

<script>
    // 1. Firebase Configuration (ข้อมูลของคุณ)
    const firebaseConfig = {
        apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
        authDomain: "goldorax-game.firebaseapp.com",
        databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "goldorax-game",
        storageBucket: "goldorax-game.firebasestorage.app",
        messagingSenderId: "601999451419",
        appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
        measurementId: "G-09PW99QK06"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatRef = db.ref('messages');

    // สร้าง ID สุ่มสำหรับผู้ใช้ (เพื่อแยก Me/You เบื้องต้น)
    const myId = "user_" + Math.floor(Math.random() * 1000000);

    // 2. ฟังก์ชันส่งข้อความ
    function sendMsg() {
        const input = document.getElementById('mainInput');
        const text = input.value.trim();
        if(!text) return;

        const msgData = {
            senderId: myId,
            text: text,
            time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };

        // ส่งไป Firebase
        chatRef.push(msgData);
        input.value = "";
    }

    // 3. ฟังก์ชันโหลดข้อความแบบ Real-time
    function loadChat() {
        chatRef.on('child_added', (snapshot) => {
            const data = snapshot.val();
            // ถ้า senderId ตรงกับเรา ให้แสดงเป็น 'me' ถ้าไม่ตรงให้เป็น 'you'
            const side = data.senderId === myId ? 'me' : 'you';
            renderMsg(data, side);
        });
    }

    // 4. ฟังก์ชันแสดงผลบนหน้าจอ (รักษาดีไซน์เดิม)
    function renderMsg(data, side) {
        const container = document.getElementById('chat-container');
        const div = document.createElement('div');
        div.className = `msg ${side}`;
        
        div.innerHTML = `
            <div class="text">${data.text}</div>
            <div style="font-size:10px; opacity:0.6; margin-top:5px; text-align:right">${data.time}</div>
        `;

        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
    }

    function openCall(type) { alert(type + " Call: ฟีเจอร์นี้ต้องเชื่อมต่อ WebRTC เพิ่มเติมครับ"); }

    // เริ่มทำงาน
    window.onload = loadChat;
</script>

</body>
</html>
